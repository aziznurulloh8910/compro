---
const currentPath = Astro.url.pathname;

const whiteBackgroundPages = [
    '/ContactPage',
    '/solutions/WebDevelopmentPage',
    '/solutions/MobileAppsPage',
    '/solutions/IotEngineeringPage',
    '/solutions/MaintenancePage',
    '/solutions/EngineeringPage',
    '/PartnersPage', 
    '/TermsPage',
    '/PrivacyPage'
];

const isWhiteBackgroundPage = whiteBackgroundPages.includes(currentPath);
---

<nav class={`fixed top-0 flex justify-between items-center w-full z-20 px-4 py-6 md:px-14 md:py-4 transition-all duration-300`} id="nav" data-white-bg={isWhiteBackgroundPage}>
    <a href="/index.html" class="hidden md:flex">
        <img src="/img/icons/logo-circle.svg" class="w-[48px] md:w-12 mr-2">
        <span class={`text-[10px] md:text-xs font-bold ${isWhiteBackgroundPage ? 'text-gray-900' : 'text-white'}`}>BANDUNG<br>SEMESTA<br>TEKNOLOGI</span>
    </a>

    <div class={`hidden md:flex nav-links justify-center items-center gap-8 ${isWhiteBackgroundPage ? 'text-gray-900' : 'text-white'}`}>
        <a 
            class={`text-sm font-bold transition-colors ${
                currentPath === '/' 
                    ? 'font-bold' 
                    : isWhiteBackgroundPage 
                        ? 'hover:text-sky-500 font-medium' 
                        : 'hover:text-sky-300 font-medium'
            }`} 
            href="/"
        >
            HOME
        </a>
        <a 
            class={`text-sm font-medium transition-colors ${
                currentPath === '/AboutPage' 
                    ? 'font-bold' 
                    : isWhiteBackgroundPage 
                        ? 'hover:text-sky-500 font-medium' 
                        : 'hover:text-sky-300 font-medium'
            }`} 
            href="/AboutPage"
        >
            ABOUT US
        </a>
        
        <div class={`service-dropdown font-medium text-sm relative ${isWhiteBackgroundPage ? 'text-gray-900' : 'text-white'}`}>
            <button class={`dropdown-toggle flex items-center gap-2 rounded transition-colors ${isWhiteBackgroundPage ? 'hover:text-sky-500' : 'hover:text-sky-300'}`} type="button">
            <span>SERVICES</span>
            <svg class="w-3 h-3 transition-transform duration-200 dropdown-chevron" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <title>chevron-down</title>
                <g fill="none">
                <path d="M19.5 8.25l-7.5 7.5-7.5-7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                </g>
            </svg>
            </button>
            <div class="dropdown-menu absolute hidden bg-gray-900 text-white font-medium text-sm rounded-b-lg w-48 top-full left-0 shadow-lg">
                <a href="/services/ProjectBasedPage" class="text-sm block px-6 py-2 hover:bg-gray-800 transition-colors">Project-based</a>
                <a href="/services/ManagedServicePage" class="text-sm block px-6 py-2 hover:bg-gray-800 transition-colors">Managed Service</a>
                <a href="/services/EngineeringPage" class="text-sm block px-6 py-2 hover:bg-gray-800 transition-colors">Engineering</a>
            </div>
        </div>

        <div class={`service-dropdown font-medium text-sm relative ${isWhiteBackgroundPage ? 'text-gray-900' : 'text-white'}`}>
            <button class={`dropdown-toggle flex items-center gap-2 rounded transition-colors ${isWhiteBackgroundPage ? 'hover:text-sky-500' : 'hover:text-sky-300'}`} type="button">
            <span>SOLUTIONS</span>
            <svg class="w-3 h-3 transition-transform duration-200 dropdown-chevron" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <title>chevron-down</title>
                <g fill="none">
                <path d="M19.5 8.25l-7.5 7.5-7.5-7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                </g>
            </svg>
            </button>
            <div class="dropdown-menu absolute hidden bg-gray-900 text-white font-medium text-sm rounded-b-lg pb-2 w-48 top-full left-0 shadow-lg">
                <a href="/solutions/WebDevelopmentPage" class="text-sm block px-6 py-2 hover:bg-gray-800 transition-colors">Web Development</a>
                <a href="/solutions/MobileAppsPage" class="text-sm block px-6 py-2 hover:bg-gray-800 transition-colors">Mobile Apps Development</a>
                <a href="/solutions/IotEngineeringPage" class="text-sm block px-6 py-2 hover:bg-gray-800 transition-colors">IoT Engineering</a>
                <a href="/solutions/MaintenancePage" class="text-sm block px-6 py-2 hover:bg-gray-800 transition-colors">Maintenance</a>
                <a href="/solutions/EngineeringPage" class="text-sm block px-6 py-2 hover:bg-gray-800 transition-colors">Engineering</a>
            </div>
        </div>

        <a class={`text-sm font-medium transition-colors ${isWhiteBackgroundPage ? 'text-gray-900 hover:text-sky-500' : 'text-white hover:text-sky-300'}`} href="">PARTNERS</a>
    </div>

    <a class={`hidden md:block border-2 py-3 px-5 text-sm font-medium rounded-md transition-colors ${
        isWhiteBackgroundPage 
            ? 'border-gray-900 text-gray-900 hover:bg-gray-900 hover:text-white' 
            : 'border-white text-white hover:bg-white hover:text-gray-900'
    }`} href="/ContactPage">CONTACT US</a>

    <div x-data="{ expanded: false }" class="md:hidden flex justify-between items-center w-full" :class="expanded ? 'absolute w-full top-0 right-0 z-20 bg-gray-800 px-4 py-6' : 'bg-transparent'">
        <button @click="expanded = !expanded" :aria-expanded="expanded" aria-controls="mobile-nav" :class="expanded ? 'z-30' : ''">
            <img src={`${isWhiteBackgroundPage ? "/img/icons/hamburger-dark.svg" : "/img/icons/hamburger.svg"}`} alt="" class="w-[24px]">
        </button>
        
        <a href="/index.html" class="flex">
            <img src="/img/icons/logo-circle.svg" class="w-[48px] mr-2">
            <span class={`text-[10px] font-bold ${isWhiteBackgroundPage ? 'text-gray-900' : 'text-white'}`}>BANDUNG<br>SEMESTA<br>TEKNOLOGI</span>
        </a>
        
        <div id="mobile-nav" :class="expanded ? 'mt-10 absolute flex flex-col gap-4 left-0 top-0 md:hidden w-screen h-screen py-6 bg-gray-800 text-white transform origin-center transition duration-400 ease-in-out' : 'hidden'">
            <a 
                class={`text-sm font-bold pl-4 transition-colors ${
                    currentPath === '/' 
                        ? 'font-bold' 
                        : 'hover:text-sky-300 font-medium'
                }`} 
                href="/"
            >
                Home
            </a>
            <a 
                class={`text-sm font-medium pl-4 transition-colors ${
                    currentPath === '/AboutPage' 
                        ? 'font-bold' 
                        : 'hover:text-sky-300 font-medium'
                }`} 
                href="/AboutPage"
            >
                About Us
            </a>
            
            <div x-data="{ expanded: false }" class="relative px-4 transform origin-center transition duration-400 ease-in-out" @click="expanded = !expanded" :aria-expanded="expanded" aria-controls="link-service" :class="expanded ? 'bg-gray-900 py-2' : 'bg-gray-800'">
                <h2 class="text-2xl font-bold">
                    <button id="link-service-title" type="button" class="flex items-center justify-between w-full text-left font-medium text-sm hover:text-sky-300 transition-colors" :class="{'py-2' : expanded}">
                        Services
                        <svg class="w-3 h-3 fill-white shrink-0" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <title>chevron-down</title>
                            <g fill="none">
                            <path d="M19.5 8.25l-7.5 7.5-7.5-7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="transform origin-center transition duration-400 ease-out" :class="{'!rotate-180': expanded}"></path>
                            </g>
                        </svg>                             
                    </button>
                </h2>
                <div id="link-service" role="region" aria-labelledby="link-service-title" class="grid text-sm text-slate-600 overflow-hidden transition-all duration-300 ease-in-out" :class="expanded ? 'grid-rows-[1fr] opacity-100' : 'hidden grid-row-[0fr] opacity-0'" >
                    <div class="overflow-hidden flex flex-col text-white text-sm gap-5 my-2 md:my-0">
                        <a href="/services/ProjectBasedPage" class="text-xs hover:text-sky-300 transition-colors">Project-based</a>
                        <a href="/services/ManagedServicePage" class="text-xs hover:text-sky-300 transition-colors">Managed Service</a>
                        <a href="/services/EngineeringPage" class="text-xs hover:text-sky-300 transition-colors">Engineering</a>
                    </div>
                </div>
            </div>
            
            <div x-data="{ expanded: false }" class="relative px-4 transform origin-center transition duration-400 ease-in-out" @click="expanded = !expanded" :aria-expanded="expanded" aria-controls="link-solutions" :class="expanded ? 'bg-gray-900 py-2' : 'bg-gray-800'">
                <h2 class="text-2xl font-bold">
                    <button id="link-solutions-title" type="button" class="flex items-center justify-between w-full text-left font-medium text-sm hover:text-sky-300 transition-colors" :class="{'py-2' : expanded}">
                        Solutions
                        <svg class="w-3 h-3 fill-white shrink-0" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <title>chevron-down</title>
                            <g fill="none">
                            <path d="M19.5 8.25l-7.5 7.5-7.5-7.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="transform origin-center transition duration-400 ease-out" :class="{'!rotate-180': expanded}"></path>
                            </g>
                        </svg>                             
                    </button>
                </h2>
                <div id="link-solutions" role="region" aria-labelledby="link-solutions-title" class="grid text-sm text-slate-600 overflow-hidden transition-all duration-300 ease-in-out" :class="expanded ? 'grid-rows-[1fr] opacity-100' : 'hidden grid-row-[0fr] opacity-0'" >
                    <div class="overflow-hidden flex flex-col text-white text-sm gap-5 my-2 md:my-0">
                        <a href="/solutions/WebDevelopmentPage" class="text-xs hover:text-sky-300 transition-colors">Web Development</a>
                        <a href="/solutions/MobileAppsPage" class="text-xs hover:text-sky-300 transition-colors">Mobile Apps Development</a>
                        <a href="/solutions/IotEngineeringPage" class="text-xs hover:text-sky-300 transition-colors">IoT Engineering</a>
                        <a href="/solutions/MaintenancePage" class="text-xs hover:text-sky-300 transition-colors">Maintenance</a>
                        <a href="/solutions/EngineeringPage" class="text-xs hover:text-sky-300 transition-colors">Engineering</a>
                    </div>
                </div>
            </div>

            <a class="text-sm text-white font-medium pl-4 hover:text-sky-300 transition-colors" href="">Partners</a>                
        </div>
    </div>
</nav>

<script is:inline>
    (function() {
        function initDropdowns() {
            var dropdowns = document.querySelectorAll('.service-dropdown');
            
            for (var i = 0; i < dropdowns.length; i++) {
                var dropdown = dropdowns[i];
                var toggle = dropdown.querySelector('.dropdown-toggle');
                var menu = dropdown.querySelector('.dropdown-menu');
                var chevron = dropdown.querySelector('.dropdown-chevron');
                
                if (toggle && menu) {
                    toggle.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        var currentMenu = this.nextElementSibling;
                        var currentChevron = this.querySelector('.dropdown-chevron');
                        
                        for (var j = 0; j < dropdowns.length; j++) {
                            var otherMenu = dropdowns[j].querySelector('.dropdown-menu');
                            var otherChevron = dropdowns[j].querySelector('.dropdown-chevron');
                            if (otherMenu && otherMenu !== currentMenu) {
                                otherMenu.classList.add('hidden');
                                if (otherChevron) {
                                    otherChevron.classList.remove('rotate-180');
                                }
                            }
                        }
                        
                        currentMenu.classList.toggle('hidden');
                        if (currentChevron) {
                            currentChevron.classList.toggle('rotate-180');
                        }
                    };
                }
            }
            
            document.onclick = function(e) {
                var isDropdown = false;
                var element = e.target;
                while (element) {
                    if (element.classList && element.classList.contains('service-dropdown')) {
                        isDropdown = true;
                        break;
                    }
                    element = element.parentElement;
                }
                
                if (!isDropdown) {
                    for (var k = 0; k < dropdowns.length; k++) {
                        var menu = dropdowns[k].querySelector('.dropdown-menu');
                        var chevron = dropdowns[k].querySelector('.dropdown-chevron');
                        if (menu) {
                            menu.classList.add('hidden');
                        }
                        if (chevron) {
                            chevron.classList.remove('rotate-180');
                        }
                    }
                }
            };
        }
        
        function initScrollEffect() {
            var nav = document.getElementById('nav');
            if (!nav) return;
            
            var isWhiteBackgroundPage = nav.getAttribute('data-white-bg') === 'true';
            
            if (!isWhiteBackgroundPage) {
                function updateNavBackground() {
                    var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    
                    if (scrollTop > 50) {
                        nav.style.background = 'linear-gradient(to bottom, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0))';
                    } else {
                        nav.style.background = 'transparent';
                    }
                }
                
                updateNavBackground();
                
                var ticking = false;
                function requestTick() {
                    if (!ticking) {
                        requestAnimationFrame(updateNavBackground);
                        ticking = true;
                        setTimeout(function() {
                            ticking = false;
                        }, 16);
                    }
                }
                
                window.addEventListener('scroll', requestTick);
            }
        }
        
        function init() {
            initDropdowns();
            initScrollEffect();
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
</script>